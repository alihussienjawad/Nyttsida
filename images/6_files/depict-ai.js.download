!function(){if(function(e){var t="currentScript",n=e.getElementsByTagName("script");t in e||Object.defineProperty(e,t,{get:function(){try{throw new Error}catch(r){var e,t=(/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(r.stack)||[!1])[1];for(e in n)if(n[e].src==t||"interactive"==n[e].readyState)return n[e];return null}}})}(document),window.self===window.top){var e=!1;try{var t,n,r,o,i,s=document.createElement("iframe");s.src="about:blank",document.head.appendChild(s);var a=null==s||null===(t=s.contentWindow)||void 0===t||null===(n=t.String)||void 0===n||null===(r=n.prototype)||void 0===r||null===(o=r.replaceAll)||void 0===o||null===(i=o.toString)||void 0===i?void 0:i.call(o);s.parentNode.removeChild(s),a&&a.indexOf("[native code]")>-1&&(e=!0)}catch(e){}if(e)new Function('(()=>{const e="true"===document.currentScript?.dataset?.debug||"true"===localStorage.getItem("debug");function t(...t){e&&console.log("[depict]",...t)}function n(...t){e&&console.warn("[depict]",...t)}async function r(e,n,...i){let s;return s=void 0===e[n]?await(async(e,n)=>{const r=(new Date).getTime();let i,s;t("waiting for definition of variable",e,"in",n);let a=!1;const c=new Promise((e=>s=e)),l=o(n,e),d="function"==typeof l?.get?l.get:()=>i,u="function"==typeof l?.set?new Proxy(l.set,{apply:(e,t,n)=>(a||(a=!0,s(n[0])),e.apply(t,n))}):e=>(a||(a=!0,s(e)),i=e);Object.defineProperty(n,e,{configurable:!0,enumerable:!0,get:d,set:u}),t("everything\'s set up, waiting for promise by setter to resolve");const h=await c;return t("Promise resolved, ",h," is here. We waited",(new Date).getTime()-r,"ms"),h})(n,e).catch(d):e[n],i?.length?await r(s,...i).catch(d):s}function o(e,t){if(null!=e)return Object.hasOwnProperty.call(e,t)?Object.getOwnPropertyDescriptor(e,t):o(Object.getPrototypeOf(e),t)}function i(e,t,n,r,o){const i=["_version","_stack","_lastEventId"],a={},c=[];let l;async function d(){let i;const d=console.log.bind(console);n||(n=()=>{});let u=0;for(;!(i=await l);){if(++u>3)return void(l=!1);l=s(e,t,{dlog:n,err:d},r,o).catch(d)}for(const e in a){const t=a[e];t.forEach(((n,r)=>{const{args:o,resolve:s}=n;try{i.run((t=>{if("function"==typeof t[e]){const n=o.map((e=>"function"==typeof e?e.bind(t):e));s(t[e](...n))}else s(void 0)}))}catch(e){d(e)}t.splice(r,1)}))}c.forEach(((e,t)=>{const[n,r]=e;r(i[n]),c.splice(t,1)}))}return new Proxy({},{get(e,t){if("then"===t)return;let n;const r=new Promise((e=>n=e)),o=t.toString();return o.includes("Symbol")?e[t]:i.includes(o)?(c.push([t,n]),d(),r):(...e)=>(Array.isArray(a[t])||(a[t]=[]),a[t].push({args:e,resolve:n}),d(),r)}})}async function s(e,t={},{dlog:n,err:o},i,s){const a=document.createElement("script");a.type="text/javascript",a.async=!0,s&&(a.integrity=s,a.setAttribute("crossorigin","anonymous")),a.src=i||"https://cdn.depict.ai/lazy_sentry/depict-ai.js",document.head.appendChild(a);const c="_depict_ai_sentry",{BrowserClient:l,Hub:d,defaultIntegrations:u}=await r(window,c);delete window[c];{const e=parseFloat("0.02");t.sampleRate??(t.sampleRate=e)}const h=new l({dsn:"https://1dd6c18a286b40a69dab1cdfe80bad9b@o464891.ingest.sentry.io/5476183",release:"6fd2d0daac8f427b2289114cce4714c66c9748e1",environment:e,whitelistUrls:[/localhost/,/static-scripts-deploy\\.s3\\.eu-north-1\\.amazonaws\\.com/,/proxy\\.demo\\.depict\\.ai/,/cdn\\.depict\\.ai/],integrations:u,...t}),p=new d(h);return p.bindClient(h),p}const a=e?c():i("boozt",void 0,t);function c(){return{captureException:()=>{},captureMessage:()=>{},withScope:()=>{}}}function l(e){return function(){try{if("AsyncFunction"===e?.constructor?.name)return e.apply(this,arguments).catch(d);const t=e.apply(this,arguments);return"function"==typeof t?.catch?t.catch(d):t}catch(e){d(e,Error())}}}function d(n,r){t(n),e&&console.trace();{const{stack:e}=r instanceof Error?r:Error();a.withScope((function(t){t.setExtra("stack",e),t.setLevel("error"),this.captureMessage(n)}))}}async function u(e,t,n,r,o){e&&!e.depict_tracked&&(e.addEventListener(o||"click",l((async e=>{if(!e.isTrusted)return void console.log("ignoring event",e,"because it\'s not user generated");const o=await t(void 0,e);if(o){const t="depict_attribution_"+o,i=localStorage.getItem(t);i?(localStorage.removeItem(t),n(o,i,!1,e)):r&&n(o,i,!0,e)}}))),e.depict_tracked=!0)}function h(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e).value}function p(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}function f(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function g(e){let t,n=!1;return l((async(...r)=>{if(!n){n=!0;const o=l(e)(...r);t=o.finally((()=>n=!1))}return t}))}function _(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var m=0;function w(e){return"__private_"+m+++"_"+e}var y=w("values_to_resolve_with"),v=w("internal_resolve"),b=w("previous_promise"),k=w("work_queue_max_once"),E=w("work_queue");class S{constructor(){Object.defineProperty(this,E,{value:O}),Object.defineProperty(this,y,{writable:!0,value:[]}),Object.defineProperty(this,v,{writable:!0,value:void 0}),Object.defineProperty(this,b,{writable:!0,value:Promise.resolve()}),this.promise=new Promise((e=>_(this,v)[v]=e)),Object.defineProperty(this,k,{writable:!0,value:g(_(this,E)[E].bind(this))}),this.resolve=e=>{_(this,y)[y].push(e),_(this,k)[k]()}}}async function O(){const e=_(this,y)[y];for(let t=0;t<e.length;t++){await _(this,b)[b];const n=_(this,v)[v];_(this,b)[b]=this.promise,this.promise=new Promise((e=>_(this,v)[v]=e)),n(e[t])}for(;e.length;)e.pop()}\n/*! (c) Andrea Giammarchi - ISC */var x={};try{x.EventTarget=(new EventTarget).constructor}catch(e){!function(e,t){var n=e.create,r=e.defineProperty,o=i.prototype;function i(){t.set(this,n(null))}function s(e,t,n){r(e,t,{configurable:!0,writable:!0,value:n})}function a(e){var t=e.options;return t&&t.once&&e.target.removeEventListener(this.type,e.listener),"function"==typeof e.listener?e.listener.call(e.target,this):e.listener.handleEvent(this),this._stopImmediatePropagationFlag}s(o,"addEventListener",(function(e,n,r){for(var o=t.get(this),i=o[e]||(o[e]=[]),s=0,a=i.length;s<a;s++)if(i[s].listener===n)return;i.push({target:this,listener:n,options:r})})),s(o,"dispatchEvent",(function(e){var n=t.get(this)[e.type];return n&&(s(e,"target",this),s(e,"currentTarget",this),n.slice(0).some(a,e),delete e.currentTarget,delete e.target),!0})),s(o,"removeEventListener",(function(e,n){for(var r=t.get(this),o=r[e]||(r[e]=[]),i=0,s=o.length;i<s;i++)if(o[i].listener===n)return void o.splice(i,1)})),x.EventTarget=i}(Object,new WeakMap)}var j,P=x.EventTarget;"object"==typeof window&&((j=window).EventTarget||(j.EventTarget=P));const T=6e4;var A=new WeakSet,L=new WeakSet,M=new WeakSet;class N extends P{increase_fails(){p(this,q,+h(this,q)+1),h(this,q)>h(this,G)&&(h(this,C).call(this),p(this,q,0))}async send(...e){this.current_socket.send(...e)}constructor(e,n,r={}){super(),I.set(this,{writable:!0,value:void 0}),W.set(this,{writable:!0,value:["close","error","message","open"]}),D.set(this,{writable:!0,value:{}}),C.set(this,{writable:!0,value:void 0}),R.set(this,{writable:!0,value:100}),q.set(this,{writable:!0,value:0}),G.set(this,{writable:!0,value:20}),B.set(this,{writable:!0,value:T}),A.add(this),L.add(this),M.add(this),p(this,I,[e,n]);const{max_backoff_ms:o}=r;o&&p(this,B,o),f(this,L,z).call(this),f(this,A,U).call(this),f(this,M,F).call(this).catch(d),this.addEventListener("open",(()=>{t("Connection opened"),p(this,R,100)}))}}var I=new WeakMap,W=new WeakMap,D=new WeakMap,C=new WeakMap,R=new WeakMap,q=new WeakMap,G=new WeakMap,B=new WeakMap;function U(){this.current_socket=new WebSocket(...h(this,I)),h(this,W).forEach((e=>{this.current_socket.addEventListener(e,l((t=>{let n;if(t instanceof Event)try{n=new t.constructor(t.type,t)}catch(e){n=new CustomEvent(t.type,t);const r={};for(const e in t)r[e]=t[e];delete r.target,Object.assign(n,r)}else n=new Event(e),delete t.target,delete t.type,Object.assign(n,t);this.dispatchEvent(n)})))}))}function z(){for(const e of h(this,W))Object.defineProperty(this,"on"+e,{configurable:!1,enumerable:!0,get:()=>h(this,D)[e],set:t=>h(this,D)[e]=t}),this.addEventListener(e,l((t=>{const n=h(this,D)[e];"function"==typeof n&&l(n).call(e,t)})))}async function F(){for(;;){const e=await new Promise((e=>{this.addEventListener("close",e),this.addEventListener("error",e),p(this,C,e)}));this.removeEventListener("close",h(this,C)),this.removeEventListener("error",h(this,C)),t("Somehow the websocket died",e,"message:",e?.message,"code:",e?.code,"reason:",e?.reason,"reconnecting in",h(this,R)),await new Promise((e=>setTimeout(e,h(this,R)))),p(this,R,h(this,R)*(1.5+Math.random())),h(this,R)>h(this,B)&&p(this,R,h(this,B)*(1+Math.random()/10)),f(this,A,U).call(this)}}var K=new WeakSet,V=new WeakSet;class H extends N{async ensure_sent(e){const r=JSON.stringify(e),o=f(this,V,Q).call(this,r);for(;;){const{data:r}=await h(this,J).promise,i=JSON.parse(r);if(i.id==e.id){const{status:s}=i;if("ack"==s){o();continue}return"not-ok"==s?n("Got reply not-ok reply from server for event!",e,i):"ok"==s?t("Successfully sent",e,i):n("Strange reply from WSS server to",e,":",i),o(),[i,r]}}}constructor(...e){super(...e),J.set(this,{writable:!0,value:new S}),Y.set(this,{writable:!0,value:5e3}),K.add(this),V.add(this);const t=e[2]?.initial_retry_ms;t&&p(this,Y,t),this.addEventListener("message",l(h(this,J).resolve))}}var J=new WeakMap,Y=new WeakMap;async function $(e){for(;1!==this.current_socket.readyState;)await new Promise((e=>{this.addEventListener("open",e,{once:!0})}));this.send(e)}function Q(e){let t=h(this,Y),n=!1;return(async()=>{for(;!n;){if(await f(this,K,$).call(this,e),await new Promise((e=>setTimeout(e,t))),n)return;t*=1.5+Math.random(),t>T&&(t=T*(Math.random()+1)),this.increase_fails()}})().catch(d),()=>n=!0}function X(){return(2e17*Math.random()).toString(36)}const Z=l,ee=Z((()=>new H("wss://proxy.depict.ai:7315/")))(),te=["tenant","market","type","user_id","session_id","product_id","entity_identifiers","url","entity_price","currency","document_referrer","document_width","attribution_id","recommendation_id","click_location","ab_test_group","variant_ids","dsid","transaction_id"],ne=Z((e=>e.map((e=>Object.fromEntries(Object.entries(e).filter((([e,t])=>te.includes(e)&&null!=t))))))),re=Z((async e=>{for(let t=0;t<e.length;t++){const n=X();ee.ensure_sent({id:n,event:e[t]}).catch(d)}})),oe=Z(((e,n=!0)=>n&&"function"==typeof WebSocket&&"function"==typeof ee?.ensure_sent?re(e):(t("Sending to depict (beacon)",e),ie("https://api.depict.ai/create-events",e)))),ie=Z(((e,n)=>{const r=JSON.stringify(n);try{var o=navigator.sendBeacon(e,new Blob([r],{type:"application/json"}))}catch(n){t("Beacon has failed",n,"falling back to sending with wrong mime type which might work");try{o=navigator.sendBeacon(e,new Blob([r],{type:"application/x-www-form-urlencoded"}))}catch(o){t("Beacon fallback has failed",o,"trying fetch"),fetch(e,{headers:{"content-type":"application/json"},body:r,method:"POST",mode:"cors",credentials:"include"}).then((e=>e.text())).then((e=>t("Beacon fallback fallback transmission result",e))).catch((t=>{a.withScope((function(i){i.setExtra("stack",Error().stack),i.setExtra("url",e),i.setExtra("payload",r),i.setExtra("first_error",n),i.setExtra("second_error",o),i.setTag("feature","beacon"),i.setTag("approach","fetch_fallback"),i.setLevel("error"),this.captureMessage(t)}))}))}}return o})),se=Z(((e,t)=>oe(ne(e),t)));let ae=l((()=>{let e,t,n;try{var r;e=(r=localStorage)._dep_id||(r._dep_id=X())}catch(e){d(e),t=e}if(!e){try{const t=()=>document.cookie.split(";").reduce(((e,t)=>{const[n,r]=t.trim().split("=").map(decodeURIComponent);return Object.assign(e,{[n]:r})}),{})._dep_id;e=t(),e||(document.cookie=`_dep_id=${X()}; expires=Fri, 31 Dec 9999 23:59:59 GMT`,e=t())}catch(e){d(e),n=e}a.withScope((function(r){r.setExtra("id",e),r.setExtra("ls_error",t),r.setExtra("cookie_error",n),r.setLevel("error"),this.captureMessage((e?"localStorage":"cookie and localStorage")+" failed to hold a value!")}))}return e||(e=X()),e}));const ce=l((e=>ae=e)),le=l(((e,t)=>{const n=[{tenant:e?.TENANT,market:e?.MARKET,user_id:ae(),dsid:ae(),url:document.location.href,entity_price:e?.sale_price,document_width:window.innerWidth,document_referrer:document?.referrer,...e}];return se(n,t)})),de=l((e=>le({...e,type:"click"},!1))),ue=l((e=>le({...e,type:"add_to_cart"}))),he=[],pe=[];let fe=!1;var ge=({listener:e,selector:t,callback:n})=>{const r=n;return{listener:e,selector:t,callback:n=(...e)=>{const[t]=e,{event:n}=t;(n&&"exists"!=n?he:pe).push({callback:r,args:e}),fe||(fe=!0,setTimeout(_e,0))}}};function _e(){try{fe=!1;const e=new Map;for(let t=0;t<pe.length;t++){const n=pe[t],r=n.callback;let o=e.get(r);o||(o=[],e.set(r,o)),o.push(n)}for(;pe.length;)pe.pop();for(const t of e.values()){const e=new Map;for(let n=0;n<t.length;n++){const r=t[n];e.set(r.args[0].element,r)}for(const t of e.values()){const{callback:e,args:n}=t;e(...n)}}(({arr:e,exclude_keys:t})=>{for(let n=0;n<e.length;n++){const r=e[n];if(r?.args?.length&&"object"==typeof r.args[0]&&"change"==r.args[0]?.event)return;for(let o=0;o<e.length;o++)if(o!==n&&me(r,e[o],t||[])){e.splice(n,1);break}}})({arr:he,exclude_keys:["mutation_record","disconnector"]});for(let e=0;e<he.length;e++){const t=he[e],{callback:n,args:r}=t;n(...r)}for(;he.length;)he.pop()}catch(e){d(e)}}function me(e,t,n){let r=!0;if(Array.isArray(e)){for(let o=0;o<e.length;o++)if("object"!=typeof e[o]||e[o]instanceof Element){if(e[o]!==t[o]){r=!1;break}}else if(!me(e[o],t[o],n)){r=!1;break}}else{const o=Object.keys(e),i=Object.keys(t);for(let s=0;s<o.length;s++)if(!n.includes(o[s])){if(o[s]!==i[s]){r=!1;break}if("object"!=typeof e[o[s]]||e[o[s]]instanceof Element){if(e[o[s]]!==t[o[s]]){r=!1;break}}else if(!me(e[o[s]],t[o[s]],n)){r=!1;break}}}return r}function we(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var ye=0;function ve(e){return"__private_"+ye+++"_"+e}var be=ve("the_mutation_observer"),ke=ve("observing"),Ee=ve("self_proxied"),Se=ve("add_listener_hooks"),Oe=ve("attribute_attribution_map_object"),xe=ve("territory"),je=ve("listeners"),Pe=ve("verbs"),Te=ve("kickstart_observer"),Ae=ve("disconnect_fn"),Le=ve("clone_deep"),Me=ve("observer_callback"),Ne=ve("check_observer_args"),Ie=ve("add_listener"),We=ve("get");class De{constructor(e={}){return Object.defineProperty(this,We,{value:Ue}),Object.defineProperty(this,Ie,{value:Be}),Object.defineProperty(this,Ne,{value:Ge}),Object.defineProperty(this,Le,{value:qe}),Object.defineProperty(this,Ae,{value:Re}),Object.defineProperty(this,Te,{value:Ce}),Object.defineProperty(this,be,{writable:!0,value:void 0}),Object.defineProperty(this,ke,{writable:!0,value:{}}),Object.defineProperty(this,Ee,{writable:!0,value:void 0}),Object.defineProperty(this,Se,{writable:!0,value:void 0}),Object.defineProperty(this,Oe,{writable:!0,value:{}}),Object.defineProperty(this,xe,{writable:!0,value:document}),Object.defineProperty(this,je,{writable:!0,value:["exists","creation","removed","change"]}),Object.defineProperty(this,Pe,{writable:!0,value:{ifexists:(e,t)=>{var n;we(this,Ne)[Ne](e,t);const r=(n=we(this,Oe)[Oe])[e]||(n[e]=new WeakSet);we(this,xe)[xe].querySelectorAll(e).forEach((n=>{r.add(n),t(new ze({element:n,selector:e,disconnector:we(this,Ae)[Ae]({event:"exists",selector:e,callback:t})}))}))},wait_for_element:(e,t)=>we(this,Ee)[Ee].wait_for_listener("exists",e,t),wait_for_listener:(e,t,n)=>(we(this,Ne)[Ne](e,(()=>{})),new Promise((r=>{const o=we(this,Ee)[Ee]["on"+e](t,(({element:e,disconnector:t})=>{r(e),t(),n&&clearTimeout(i)}));if(n)var i=setTimeout((()=>{o(),r(void 0)}),n)})))}}),Object.defineProperty(this,Me,{writable:!0,value:e=>{try{const n=we(this,Le)[Le]({...we(this,ke)[ke]}),r=we(this,Oe)[Oe];for(let o,i=0;i<e.length;i++){const s=e[i],a=[];s.addedNodes.length||s.removedNodes.length?(o=s.addedNodes,n.creation&&a.push("creation")):o=[s.target],n.exists&&a.push("exists"),n.change&&a.push("change");for(let e,i,c=0;c<a.length;c++){if(e=a[c],i=Object.keys(n[e]),"change"===e&&(s.addedNodes.length||s.removedNodes.length)){for(let t,r=0;r<i.length;r++)if(t=i[r],s.target?.matches?.(t))for(let r=0;r<n[e][t].length;r++){const o=n[e][t][r];o(new ze({element:s.target,selector:t,event:e,disconnector:we(this,Ae)[Ae]({event:e,selector:t,callback:o}),mutation_record:s}))}break}for(let a,c=0;c<o.length;c++){a=o[c];for(let o,c=0;c<i.length;c++){o=i[c];const l=a?.matches?.(o);let d;if("exists"==e){var t;if(d=r[t=o]||(r[t]=new WeakSet),"attributes"===s.type&&null!=l&&d.has(a)&&l)continue;l?d.add(a):d.delete(a)}if(l)for(let t=0;t<n[e][o].length;t++){const r=n[e][o][t];r(new ze({element:a,selector:o,event:e,disconnector:we(this,Ae)[Ae]({event:e,selector:o,callback:r}),mutation_record:s}))}if((s.addedNodes.length||s.removedNodes.length)&&a.hasChildNodes()&&a.querySelectorAll){const t=a.querySelectorAll(o);for(let r=0;r<t.length;r++){"exists"==e&&d.add(t[r]);for(let i=0;i<n[e][o].length;i++){const a=n[e][o][i];a(new ze({element:t[r],selector:o,event:e,disconnector:we(this,Ae)[Ae]({event:e,selector:o,callback:a}),mutation_record:s}))}}}}}}if(n.change){let e=s.target;for(;e=e?.parentNode;)if(e?.matches)for(let t,r=0,o=Object.keys(n.change);r<o.length;r++)if(t=o[r],e.matches?.(t)){const r=n.change[t];for(let n=0;n<r.length;n++)r[n](new ze({element:e,selector:t,event:"change",disconnector:we(this,Ae)[Ae]({event:"change",selector:t,callback:r[n]}),mutation_record:s}))}}if(n.removed&&s.removedNodes?.length){const e=Object.keys(n.removed);for(let t=0;t<s.removedNodes.length;t++)for(let r,o,i=0;i<e.length;i++){const a=[];o=e[i],r=s.removedNodes[t],r?.matches?.(o)&&a.push(r),a.push(...r?.querySelectorAll?.(o)||[]);for(let e=0;e<a.length;e++)for(let t,r=0;r<n.removed[o].length;r++)t=n.removed[o][r],t(new ze({element:a[e],selector:o,event:"removed",disconnector:we(this,Ae)[Ae]({event:"removed",selector:o,callback:t}),mutation_record:s}))}}}}catch(e){d(e)}}}),e.territory&&(we(this,xe)[xe]=e.territory),we(this,Se)[Se]=e.add_listener_hooks||[],we(this,Ee)[Ee]=new Proxy(this,{get:we(this,We)[We]})}}function Ce(){we(this,be)[be]=new MutationObserver(we(this,Me)[Me]),we(this,be)[be].observe(we(this,xe)[xe],{attributes:!0,childList:!0,subtree:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0})}function Re({event:e,selector:t,callback:n}){return()=>{const r=we(this,ke)[ke];let o=r[e];if(!o||!(o=o[t]))return;const i=o.indexOf(n);i<0||(o.splice(i,1),o.length||delete r[e][t],Object.keys(r[e]).length||delete r[e],Object.keys(r).length||(we(this,be)[be].disconnect(),we(this,be)[be]=void 0))}}function qe(e){const t=Object.assign(new e.constructor,e),n=[t];for(;n.length;){const e=n.pop();for(const t in e)"object"==typeof e[t]&&(e[t]=Object.assign(new e[t].constructor,e[t]),n.push(e[t]))}return t}function Ge(e,t){if("string"!=typeof e)throw Error("no selector specified");if("function"!=typeof t)throw Error("no callback specified")}function Be(e){const t=this;return(n,r)=>{for(const o of we(t,Se)[Se]){const t=o({listener:e,selector:n,callback:r});e=t.listener,n=t.selector,r=t.callback}if(!e||!n||!r)return void console.warn("listener, selector or callback is falsey",e,n,r);we(t,Ne)[Ne](n,r);const o=we(t,ke)[ke];return o[e]||(o[e]={}),o[e][n]?o[e][n].push(r):o[e][n]=[r],we(t,be)[be]||we(t,Te)[Te](),"exists"===e&&we(t,Pe)[Pe].ifexists(n,r),we(t,Ae)[Ae]({event:e,selector:n,callback:r})}}function Ue(e,t){const n=we(e,je)[je].includes(t.substr(2));if(Object.keys(we(e,Pe)[Pe]).includes(t))return we(e,Pe)[Pe][t];if(n)return we(e,Ie)[Ie](t.substr(2));throw Error("Property "+t+" is not valid. Valid listeners: "+we(e,je)[je].join(", ")+"; valid verbs: "+Object.keys(we(e,Pe)[Pe]).join(", "))}class ze{constructor({element:e,selector:t,disconnector:n,...r}){this.element=e,this.selector=t,this.disconnector=n;for(const e in r)this[e]=r[e]}}const Fe=Ke();function Ke(){try{return new De({add_listener_hooks:[ge]})}catch(e){d(e)}}function Ve(e,t){const n=[];for(const r of e)"querySelectorAll"in r&&n.push(...r.querySelectorAll(t)),"matches"in r&&r.matches?.(t)&&n.push(r);return n}function He(){const e=window;e.ga||(e.ga=function(){var t;((t=e.ga).q||(t.q=[])).push(arguments)}),e.ga.l=+new Date}const Je="object"==typeof globalThis&&globalThis||window,Ye=l((async(e,r)=>{if(!e)return void n("Couldn\'t load gtag, GA_ID not specified",e);const o=!1===Je?.performance?.getEntriesByType?.("navigation")?.every?.((e=>e?.loadEventEnd));t("Loading gtag after "+(o?"pageload and ":"")+"3s"+(r?"":", but setting up queues already")),r||$e(e),o&&t("page has loaded",await new Promise((e=>window.addEventListener("load",e,{once:!0})))),await new Promise((e=>setTimeout(e,3e3)));const i=document.createElement("script"),s=document.head;i.async=!0,i.src="https://www.googletagmanager.com/gtag/js?id="+e,s.appendChild(i),t("Loading gtag now",i)})),$e=l((e=>{Je.dataLayer||(Je.dataLayer=[]),Je.gtag=function(){Je.dataLayer.push(arguments)},Je.gtag("js",new Date),Je.gtag("config",e,{send_page_view:!1}),t("configuring gtag with",e)})),Qe=l((async(e,r,o)=>{if("function"==typeof Je.gtag){const n=(e,t,n)=>({id:n,list_name:"depict",list_position:e?.index||t+1,..."function"==typeof o?o(e):o}),i=(await Promise.all(e.map((async(e,t)=>e.ga_product_ids?e.ga_product_ids.map((r=>n(e,t,r))):n(e,t,e.ga_product_id||e.product_id||await r(e.page_url)||await r(e)))))).flat(),s=100;for(let e=0;e<i.length;e+=s){const n=["event","view_item_list",{items:i.slice(e,e+s)}];t("Sending product view to gtag",n),Je.gtag(...n)}}else n("not sending gtag tracking as there is no gtag")})),Xe=l(((e,r,o)=>{if("function"==typeof Je.gtag){const n=["event","select_content",{content_type:"product",items:[{id:e,list_name:"depict",list_position:r+1,...o}]}];return t("calling gtag with arguments",n),Je.gtag(...n)}n("not sending gtag tracking as there is no gtag")})),Ze=l((e=>{if("function"==typeof Je.ga)return console.log("sending",e,"to GA"),Je.ga("depict.send",{hitType:"event",eventCategory:"Depict",eventAction:e,eventLabel:"rec-bar-tracking",nonInteraction:1});n("Not sending to ga as there is no ga")})),et=l((e=>{e?("function"!=typeof Je.ga&&(t("Creating GA queue"),He()),t("Creating ga with GA-ID",e),Je.ga("create",e,"auto","depict"),Ye(e,!1)):n(Error("No GAID specified"))})),tt=l((()=>Ze("rec_bar_click"))),nt=l((()=>Ze("add_to_cart_after_rec_bar_click")));let rt;function ot(e,t){if(t??(t=0),++t>30)return e;const n={};for(const r in e){const o=e[r];let i;i=o instanceof Element?o.cloneNode(!1).outerHTML:o instanceof Headers?Object.fromEntries(o.entries()):"object"==typeof o&&null!=o&&("function"==typeof o[Symbol.iterator]||o instanceof Response)?ot(o,t):o?.toString?.(),n[r]=i}return n}async function it(e,n,r){const o="Validation error: got 422 from API",i=await e.text();t(o,"body",n,"response",e,"text",i,"stack",r),a.withScope((function(t){t.setExtra("stack",r),t.setExtra("request_body",n),t.setExtra("response",e),t.setExtra("serialized_response",ot(e)),t.setExtra("response_text",i),t.setLevel("error"),this.captureException(Error(o))}))}class st{constructor(n){this.dataset={...(n.current_script_override||document.currentScript||{}).dataset||{}},this.modify="true"===this.dataset.modify,this.is_debug=e,this.dlog=t,this.TENANT=n.TENANT||"boozt",this.MARKET=n.MARKET||"se",this.Sentry=a,this.GA_ID=n.GA_ID??"",this.TYPE=n.TYPE||"normal",this.catchify=l,this.err=d,this.GA_ID&&et(this.GA_ID),this.get_product_id=l(n.get_product_id),this.product_id=this.get_product_id,this.tenant=this.TENANT,this.market=this.MARKET,this.gaid=this.GA_ID,this.type=this.TYPE,this.catchify=l,this.err=d,this.wpf=((e,t)=>{const n=async(t,r,o,i,s,a)=>{a||(a=1),i??(i=!0);const{stack:c}=Error(),d=(...t)=>e(...t);return await fetch(t,{...r?{body:r}:{},method:"POST",...s||{},...o?{headers:o}:{}}).then((async e=>e&&e.ok&&200===e.status?await e[i?"json":"text"]().catch((e=>d("error while decoding json",e))):(422===e.status&&l(it)(e,r,c),d("Response not ok",e),!1))).catch((e=>(d("Error while fetching",e,t,r),!("TypeError"!=e.name&&"Failed to fetch"!=e.message&&"Network request failed"!=e.message||e.message.includes("CORS")||e.name.includes("CORS"))&&++a<10&&n(t,r,o,i,s,a))))};return n})(this.dlog),"true"===localStorage.getItem("highlight-depict")&&(async e=>{try{if(rt)return void rt.append(e);const n=await Fe.wait_for_element("head");rt=document.createElement("style"),rt.append(e),t("inserting",rt,"into",n),n.append(rt)}catch(e){d(e)}})(".depict { background: #f00a !important; }")}}function at(e){const t=[];for(let n=1;n<=e;n++){const r=n/e;t.push(r)}return t.push(0),t}function ct(e){return new Promise(((t,n)=>e.then(n,t)))}function lt(e){return Promise?.any?.(e)??ct(Promise.all([...e].map(ct)))}const dt=(()=>{const e=new S;return setInterval(e.resolve,1e4,"flush"),e})(),ut=new WeakSet,ht=new IntersectionObserver(l((e=>{for(let t=0;t<e.length;t++)dt.resolve(e[t])})),{threshold:at(8)});async function pt(e){let t=!1;setTimeout((()=>t=!0),1e3);let n=+new Date;for(;+new Date-n<500;){const n=await dt.promise;if("flush"!==n){if(n.target==e&&n.intersectionRatio<.5)return!1}else if(t)return!0}}const ft=new Set,gt=e=>e?.dataset?.depict_recommendation_id||e?.dataset?.recommendationId,_t=e=>e?.dataset?.depict_product_id||e?.dataset?.productId,mt=e=>e?.dataset?.ga_ids,wt=e=>[...e?.parentElement?.children||[]].indexOf(e),yt=l((async(e,r)=>{const{product_selector:o,a2c_selector:i,rec_a2c_selector:s,get_product_id:a=e.t.get_product_id,get_rec_id:c=gt,get_prod_id:h=_t,get_ga_prod_id:p=mt,get_display:f,impression_tracking:g,a2c_elements:_,product_elements:m,t:w,click_location_prefix:y=(e=>e?.parentElement?.dataset?.type+"_")}=e,v=async e=>{let t={};return h&&(t.product_id=h(e)||await a(e.querySelector("a")?.href||e?.href)),p&&(t.ga_product_id=await p(e)||await a()),c&&(t.recommendation_id=c(e)),f&&Object.assign(t,f(e)),t},b=new WeakSet,k=new WeakSet,E=new WeakSet,S={};if(w instanceof st){const{href:t}=location;if(!ft.has(t)){ft.add(t);const n=await a();if(null==n||ft.has(n))return;ft.add(n),le({...e.t,product_id:n,type:"page_view"}),await(async e=>{if("function"!=typeof BroadcastChannel)return;const t=new BroadcastChannel("right_click_attribution"),n=await e.get_product_id();e.dlog("Broadcasting",n,"to",t),t.postMessage(n),t.close()})(w)}}const O=l((async({element:o})=>{const i=wt(o),a=await v(o),c="function"==typeof y?y(o):"depict_",u="depict_"+("_"==c[c.length-1]?c.substr(0,c.length-1):c);if(g&&!b.has(o)&&(b.add(o),((e,n,r,o=!0)=>{const i=()=>{(async(e,n,r)=>{if(ut.has(e))t("Not watching",e,"as it\'s already being watched");else for(ut.add(e);;){const t=await dt.promise;if("flush"!==t){if(t.target==e&&t.intersectionRatio>=.75&&await lt([new Promise((e=>setTimeout(e,500,!0))),pt(e)]))return le({...r,...n,type:"element_visible"}),ht.unobserve(e),void ut.delete(e)}else if("function"==typeof document?.body?.contains&&!document.body.contains(e))return void ut.delete(e)}})(n,r,e).catch(d),ht.observe(n)};o?n.addEventListener("DOMInsertion",l(i)):i()})(w,o,a,!1)),a.product_id&&e.attempt_gtag_view_tracking&&!k.has(o)){k.add(o),(S[u]||(S[u]=[])).push({product_id:a.ga_product_id||a.product_id,index:i});try{let e=o?.dataset?.ga_ids;e&&(S[u]||(S[u]=[])).push(...e.split(",").map((e=>({product_id:e,index:i}))))}catch(e){n("Something went wrong on a product with multiple ga_ids",e)}}const h=l((e=>(async(e,t,n)=>{const{dlog:r,catchify:o}=e;r("Contextmenu was invoked",t);const i=t.currentTarget||t.target,s=new BroadcastChannel("right_click_attribution");if(await lt([new Promise((e=>{s.addEventListener("message",o((t=>{const{data:o}=t;r("Recieved broadcast channel event",o,t),o==n&&e(!0)})))})),new Promise((e=>setTimeout(e,6e4,!1)))])){const e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});r("Someone broadcasted our product_id! Simulating a click event on the element that was contextmenu\'d",i,e),i.addEventListener("click",(e=>(e.preventDefault(),!1)),{once:!0}),i.dispatchEvent(e)}else r("Our product_id did not get broadcasted, closing channel");s.close()})(w,e,a.product_id)));o.addEventListener("contextmenu",h),o.addEventListener("auxclick",(e=>1===e.button&&h(e))),((e,t,n,r)=>{if(!e||!e.depict_tracked||e?.depict_tracked?.recommendation_id!=n||e?.depict_tracked?.product_id!=t){const o=e=>{localStorage.setItem("depict_attribution_"+t,n),r&&r()};e.depict_tracked&&e.removeEventListener("click",e.depict_tracked?.listener),e.depict_tracked={product_id:t,recommendation_id:n,listener:o},e.addEventListener("click",o)}})(o,a.product_id||"DNT",a.recommendation_id||"not_depict",(async()=>{const t=wt(o),i=c+(t+1);if(tt(),de({...e.t||{},...e,...a,...a.recommendation_id?{}:{attribution_id:"recommendation"},click_location:i}),!e.no_gtag){const e={list_name:u,...r};Xe(a.product_id,t,e);try{a.ga_product_id&&a.ga_product_id.toString?.().split(",").forEach((n=>Xe(n,t,e)))}catch(e){n("Something went wrong when sending gtag click tracking on a product with multiple ga_ids"),d(e)}}})),s&&!E.has(o)&&(t=>{const n=t.querySelector(s);if(!n)return;const r=v(t);n.addEventListener("click",(()=>{nt(),ue({...e.t||{},...e,...r})})),E.add(o)})(o),e.shade&&vt(o),e.attempt_gtag_view_tracking&&Object.keys(S)?.length&&setTimeout(l((()=>{for(const e in S){const t=S[e];t?.length&&(Qe(t,(()=>""),{list_name:e,...r}),delete S[e])}})))}));if("string"==typeof o)Fe.onexists(o,O);else if(m&&"function"==typeof m?.[Symbol.iterator])for(const e of m)O({element:e});else d(Error("AIO can\'t find elements, try adding a selector or els"));const x=({element:t})=>{u(t,a,((t,n,r)=>{r||nt(),ue({...e.t||{},...e,product_id:t,..."not_depict"==n||r?{attribution_id:"recommendation"}:{recommendation_id:n}})}),e.always_track_a2c),e.shade&&vt(t)};if("string"==typeof i)Fe.onexists(i,x);else if(_&&"function"==typeof _?.[Symbol.iterator])for(const e of _)x({element:e});else d(Error("Can\'t find a2c button, try adding a selector or els"));return{add_a2c_element:e=>x({element:e}),add_product_element:e=>O({element:e})}})),vt=l((e=>{e.style.boxShadow="rgba(255,0,0,0.5) 10px 10px 30px 40px",e.style.background="rgba(255,0,0,0.5)",e.style.color="white"}));function bt(e,n){const r="sendHitTask",o=e.get(r);e.set(r,(e=>{o(e);try{const r=ae(),o=e.get("hitPayload"),i=new URLSearchParams(o).get("ti");i&&(t("Got interesting analytics request",o,i),((e,t,n=ae())=>{ie("https://api.depict.ai/v2/track",{tenant:e.tenant,market:e.market,events:[{transaction_id:t,dsid:n}]})})(n,i,r))}catch(e){d(e)}}))}ce((()=>"anonymous"));const kt=new st({GA_ID:"UA-23320356-1",TENANT:"boozt",MARKET:((e,t,n="boozt")=>{const r=t?new URL(t):location,{pathname:o}=r,i=e.find((e=>o.startsWith("/"+e+"/")||o==="/"+e));if(i)return i;const{hostname:s}=r;if(n){const t=RegExp(n+"[.-]"+`(${e.join("|")})`),r=s.match(t);if(r?.[1])return r[1]}const a=s.split(".").pop();return e.includes(a)?a:void 0})(["se","dk"]),get_product_id:e=>(e?new URL(e):location).pathname.match(/_(\\d+)/).pop()}),{market:Et,tenant:St,get_product_id:Ot}=kt;yt({get_product_id:Ot,product_selector:".impression-product",a2c_selector:"element[doesnt=exist]",tenant:St,market:Et,impression_tracking:!0,t:kt,get_rec_id:e=>{const t=Ve([e],"a[href]")?.[0]?.href;return t?new URL(t,window.location.href)?.searchParams?.get("token"):""},get_prod_id:e=>{const t=Ve([e],"a[href]")?.[0]?.href;return Ot(t)}}),(async e=>{Fe.onexists(".add-to-bag",(({element:e})=>{u(e,Ot,((e,t,n)=>{const r=new URLSearchParams(window.location.search).get("token");n||nt(),t=r||t||"not_depict";const o=(()=>{try{const e=document.querySelector("script[data-component-name=ColourSelector]")?.textContent,t=Object.values(JSON.parse(e).colours).find((e=>e?.eanID===kt.product_id()))?.variantID,n=window.App?.Config?.Product?.currentVariantId;return t||n}catch(e){}return""})();ue({...kt,product_id:o||e,..."not_depict"==t||n?{attribution_id:"recommendation"}:{recommendation_id:t}})}),!0)}))})().catch(d),l((e=>{He(),window.ga(l((n=>{const r=window.ga.getAll();t("we have trackers",r);const{P:o}=window.ga;function i(t){for(const n of t)l(bt)(n,e)}l(i)(r),"function"==typeof o?.push&&(o.push=new Proxy(o.push,{apply(e,t,n){const r=e.apply(t,n);return l(i)(n),r}}))})))}))(kt)})();')();else{var c=document.currentScript,l=c.src.split("/");l.pop(),l.push("compatibility.js");var d=document.createElement("script");d.src=l.join("/");for(var u=Object.keys(c.dataset),h=0;h<u.length;h++)d.dataset[u[h]]=c.dataset[u[h]];c.insertAdjacentElement("afterend",d)}}else console.warn("Depict script",document.currentScript,"executed inside a frame or iframe. I will now exit.")}();
